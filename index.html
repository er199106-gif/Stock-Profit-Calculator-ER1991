<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Profit Calculator ‚Äì ER1991</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-glass: rgba(30, 41, 59, 0.7);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --gradient-1: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-2: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            --gradient-3: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --shadow-glow: 0 0 40px rgba(99, 102, 241, 0.3);
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
        }

        .lang-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10000;
            display: flex;
            gap: 8px;
            background: var(--bg-glass);
            padding: 6px;
            border-radius: var(--radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .lang-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .lang-btn.active {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.6s ease, visibility 0.6s ease;
        }

        .splash-screen.hide {
            opacity: 0;
            visibility: hidden;
        }

        .splash-content {
            text-align: center;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .logo-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: var(--primary);
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.4;
            animation: pulse-glow 3s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.4; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.6; }
        }

        .logo-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 1.5rem;
            color: var(--primary-light);
        }

        .stock-icon {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.5));
        }

        .chart-line {
            stroke-dasharray: 200;
            stroke-dashoffset: 200;
            animation: draw 2s ease forwards;
        }

        @keyframes draw {
            to { stroke-dashoffset: 0; }
        }

        .app-name {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .app-author {
            font-size: 1.25rem;
            color: var(--text-secondary);
        }

        .loading-bar {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin: 2rem auto;
            overflow: hidden;
        }

        .loading-progress {
            height: 100%;
            background: var(--gradient-1);
            border-radius: 2px;
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; margin-left: 0%; }
            50% { width: 100%; margin-left: 0%; }
            100% { width: 0%; margin-left: 100%; }
        }

        .main-app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.6s ease;
        }

        .main-app.show {
            opacity: 1;
        }

        .glass {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            color: var(--primary-light);
        }

        .brand-icon svg {
            width: 100%;
            height: 100%;
        }

        .brand-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .brand-text span {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .main-content {
            flex: 1;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .calculator-card {
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-glow);
            position: relative;
        }

        .card-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .icon-wrapper {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-lg);
            background: var(--gradient-1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .stock-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            position: relative;
        }

        .form-group.floating {
            margin-top: 0.5rem;
        }

        .form-group.floating input {
            width: 100%;
            background: var(--bg-secondary);
            border: 2px solid var(--bg-tertiary);
            border-radius: var(--radius);
            padding: 1rem 1rem 1rem 3rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            outline: none;
        }

        .form-group.floating input:focus,
        .form-group.floating input:not(:placeholder-shown) {
            border-color: var(--primary);
            background: var(--bg-tertiary);
        }

        .form-group.floating label {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1rem;
            pointer-events: none;
            transition: all 0.3s ease;
            padding: 0 0.5rem;
        }

        body[dir="ltr"] .form-group.floating label {
            right: auto;
            left: 1rem;
        }

        .form-group.floating input:focus ~ label,
        .form-group.floating input:not(:placeholder-shown) ~ label {
            top: 0;
            right: 0.8rem;
            font-size: 0.75rem;
            color: var(--primary-light);
            background: var(--bg-secondary);
        }

        body[dir="ltr"] .form-group.floating input:focus ~ label,
        body[dir="ltr"] .form-group.floating input:not(:placeholder-shown) ~ label {
            right: auto;
            left: 0.8rem;
        }

        .form-group.floating .input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.25rem;
        }

        body[dir="ltr"] .form-group.floating .input-icon {
            left: auto;
            right: 1rem;
        }

        .form-group.floating .currency {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-light);
            font-weight: 600;
            font-size: 0.875rem;
        }

        body[dir="ltr"] .form-group.floating .currency {
            left: auto;
            right: 1rem;
        }

        .highlight-current input {
            border-color: var(--success) !important;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .highlight-commission input {
            border-color: var(--accent) !important;
            background: rgba(245, 158, 11, 0.05) !important;
        }

        .form-section {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin: 0.5rem 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }

        .section-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .section-header h3 {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .total-commission-row {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed rgba(245, 158, 11, 0.3);
        }

        .calculate-btn {
            width: 100%;
            border: none;
            border-radius: var(--radius);
            padding: 1.25rem;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            background: var(--gradient-1);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.6);
        }

        .btn-icon {
            width: 24px;
            height: 24px;
        }

        .app-footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: auto;
        }

        .result-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 1000;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }

        .result-screen.show {
            opacity: 1;
            visibility: visible;
        }

        .result-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem;
            width: 100%;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            border-radius: var(--radius);
        }

        .result-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            flex: 1;
            text-align: center;
            margin: 0;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            background: var(--primary);
        }

        .icon-btn svg {
            width: 20px;
            height: 20px;
        }

        .receipt-wrapper {
            border-radius: var(--radius-lg);
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
        }

        #receipt-canvas {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .result-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .action-btn {
            flex: 1;
            padding: 1rem;
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: none;
        }

        .action-btn.primary {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.6);
        }

        .action-btn.secondary {
            background: var(--bg-glass);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-btn.secondary:hover {
            background: var(--bg-tertiary);
        }

        .result-copyright {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: auto;
            padding-top: 1rem;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 640px) {
            .app-name { font-size: 2rem; }
            .calculator-card { padding: 1.5rem; }
            .form-row { grid-template-columns: 1fr; }
            .result-actions { flex-direction: column; }
            .lang-toggle { top: 10px; left: 10px; }
            .lang-btn { padding: 6px 12px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="lang-toggle" id="lang-toggle">
        <button class="lang-btn active" data-lang="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
        <button class="lang-btn" data-lang="en">English</button>
    </div>

    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="logo-glow"></div>
            <div class="logo-icon">
                <svg viewBox="0 0 100 100" class="stock-icon">
                    <path class="chart-line" d="M10 80 L30 60 L50 70 L70 40 L90 20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="90" cy="20" r="6" fill="currentColor"/>
                </svg>
            </div>
            <h1 class="app-name">Stock Profit Calculator</h1>
            <p class="app-author">By ER1991</p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div id="main-app" class="main-app">
        <header class="app-header glass">
            <div class="header-content">
                <div class="brand">
                    <div class="brand-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"/>
                            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h1 data-i18n="appNameShort">Stock Calc</h1>
                        <span>By ER1991</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="container">
                <div class="calculator-card glass">
                    <div class="card-header">
                        <div class="icon-wrapper">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="30" height="30">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                <line x1="8" y1="21" x2="16" y2="21"/>
                                <line x1="12" y1="17" x2="12" y2="21"/>
                            </svg>
                        </div>
                        <h2 class="section-title" data-i18n="calculatorTitle">ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ŸàÿßŸÑÿÆÿ≥ÿßÿ¶ÿ±</h2>
                    </div>
                    
                    <form id="stock-form" class="stock-form">
                        <div class="form-group floating">
                            <input type="text" id="stock-name" placeholder=" " required>
                            <label for="stock-name" data-i18n="stockName">ÿßÿ≥ŸÖ ÿßŸÑÿ≥ŸáŸÖ</label>
                            <span class="input-icon">üìà</span>
                        </div>

                        <div class="form-group floating">
                            <input type="number" id="shares-count" placeholder=" " min="1" step="1" required>
                            <label for="shares-count" data-i18n="sharesCount">ÿπÿØÿØ ÿßŸÑÿ£ÿ≥ŸáŸÖ</label>
                            <span class="input-icon">üî¢</span>
                        </div>

                        <div class="form-section">
                            <div class="section-header">
                                <span class="section-icon" style="background: var(--gradient-2);">üí∞</span>
                                <h3 data-i18n="purchaseDetails">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ¥ÿ±ÿßÿ°</h3>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group floating">
                                    <input type="number" id="purchase-price-per-share" placeholder=" " min="0" step="0.01">
                                    <label for="purchase-price-per-share" data-i18n="pricePerShare">ÿ≥ÿπÿ± ÿßŸÑÿ≥ŸáŸÖ</label>
                                    <span class="currency">$</span>
                                </div>
                                <div class="form-group floating">
                                    <input type="number" id="total-purchase-price" placeholder=" " min="0" step="0.01">
                                    <label for="total-purchase-price" data-i18n="totalAmount">ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</label>
                                    <span class="currency">$</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group floating highlight-current">
                            <input type="number" id="current-price" placeholder=" " min="0" step="0.01" required>
                            <label for="current-price" data-i18n="currentPrice">ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ≠ÿßŸÑŸä</label>
                            <span class="input-icon">üìä</span>
                            <span class="currency">$</span>
                        </div>

                        <div class="form-section">
                            <div class="section-header">
                                <span class="section-icon" style="background: var(--gradient-3);">‚öñÔ∏è</span>
                                <h3 data-i18n="commission">ÿßŸÑÿπŸÖŸàŸÑÿ©</h3>
                            </div>
                            <div class="form-row">
                                <div class="form-group floating">
                                    <input type="number" id="commission-percent" placeholder=" " min="0" max="100" step="0.01">
                                    <label for="commission-percent" data-i18n="commissionPercent">ŸÜÿ≥ÿ®ÿ© %</label>
                                    <span class="currency">%</span>
                                </div>
                                <div class="form-group floating">
                                    <input type="number" id="commission-amount" placeholder=" " min="0" step="0.01">
                                    <label for="commission-amount" data-i18n="commissionAmount">ŸÖÿ®ŸÑÿ∫ ÿ´ÿßÿ®ÿ™</label>
                                    <span class="currency">$</span>
                                </div>
                            </div>

                            <div class="form-group floating highlight-commission total-commission-row">
                                <input type="number" id="total-with-commission" placeholder=" " min="0" step="0.01">
                                <label for="total-with-commission" data-i18n="totalWithCommission">ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ÿ®ÿßŸÑÿπŸÖŸàŸÑÿ©</label>
                                <span class="currency">$</span>
                            </div>
                        </div>

                        <button type="submit" class="calculate-btn">
                            <span class="btn-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <path d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                </svg>
                            </span>
                            <span data-i18n="calculate">ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©</span>
                        </button>
                    </form>
                </div>
            </div>
        </main>

        <footer class="app-footer glass">
            <p>¬© ER1991 2026</p>
        </footer>
    </div>

    <div id="result-screen" class="result-screen hidden">
        <div class="result-container">
            <div class="result-header glass">
                <button id="back-btn" class="icon-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h2 data-i18n="result">ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©</h2>
            </div>

            <div class="receipt-wrapper glass">
                <canvas id="receipt-canvas" width="600" height="900"></canvas>
            </div>

            <div class="result-actions">
                <button id="download-btn" class="action-btn primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="20" height="20">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                    </svg>
                    <span data-i18n="download">ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©</span>
                </button>
                <button id="new-calc-btn" class="action-btn secondary">
                    <span>üîÑ</span>
                    <span data-i18n="newCalc">ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ</span>
                </button>
            </div>

            <p class="result-copyright">¬© ER1991 2026</p>
        </div>
    </div>

    <script>
        const translations = {
            ar: {
                appNameShort: 'Stock Calc',
                calculatorTitle: 'ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ŸàÿßŸÑÿÆÿ≥ÿßÿ¶ÿ±',
                stockName: 'ÿßÿ≥ŸÖ ÿßŸÑÿ≥ŸáŸÖ',
                sharesCount: 'ÿπÿØÿØ ÿßŸÑÿ£ÿ≥ŸáŸÖ',
                purchaseDetails: 'ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ¥ÿ±ÿßÿ°',
                pricePerShare: 'ÿ≥ÿπÿ± ÿßŸÑÿ≥ŸáŸÖ',
                totalAmount: 'ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä',
                totalWithCommission: 'ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ÿ®ÿßŸÑÿπŸÖŸàŸÑÿ©',
                currentPrice: 'ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ≠ÿßŸÑŸä',
                commission: 'ÿßŸÑÿπŸÖŸàŸÑÿ©',
                commissionPercent: 'ŸÜÿ≥ÿ®ÿ© %',
                commissionAmount: 'ŸÖÿ®ŸÑÿ∫ ÿ´ÿßÿ®ÿ™',
                calculate: 'ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©',
                result: 'ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©',
                download: 'ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©',
                newCalc: 'ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ',
                profit: 'ÿ±ÿ®ÿ≠',
                loss: 'ÿÆÿ≥ÿßÿ±ÿ©',
                purchaseSummary: 'ŸÖŸÑÿÆÿµ ÿßŸÑÿ¥ÿ±ÿßÿ°',
                quantity: 'ÿßŸÑŸÉŸÖŸäÿ©',
                currentValue: 'ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©',
                totalSelling: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ®Ÿäÿπ ÿßŸÑÿµÿßŸÅŸä',
                date: 'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ',
                time: 'ÿßŸÑŸàŸÇÿ™'
            },
            en: {
                appNameShort: 'Stock Calc',
                calculatorTitle: 'Profit & Loss Calculator',
                stockName: 'Stock Name',
                sharesCount: 'Number of Shares',
                purchaseDetails: 'Purchase Details',
                pricePerShare: 'Price per Share',
                totalAmount: 'Total Amount',
                totalWithCommission: 'Total with Commission',
                currentPrice: 'Current Price',
                commission: 'Commission',
                commissionPercent: 'Percentage %',
                commissionAmount: 'Fixed Amount',
                calculate: 'Calculate Result',
                result: 'Result',
                download: 'Download Image',
                newCalc: 'New Calculation',
                profit: 'Profit',
                loss: 'Loss',
                purchaseSummary: 'Purchase Summary',
                quantity: 'Quantity',
                currentValue: 'Current Value',
                totalSelling: 'Net Selling Amount',
                date: 'Date',
                time: 'Time'
            }
        };

        class StockCalculator {
            constructor() {
                this.currentLang = 'ar';
                this.initElements();
                this.bindEvents();
                this.calculationData = null;
                this.initApp();
            }

            initElements() {
                this.splashScreen = document.getElementById('splash-screen');
                this.mainApp = document.getElementById('main-app');
                this.resultScreen = document.getElementById('result-screen');
                this.langToggle = document.getElementById('lang-toggle');

                this.form = document.getElementById('stock-form');
                this.stockName = document.getElementById('stock-name');
                this.sharesCount = document.getElementById('shares-count');
                this.purchasePricePerShare = document.getElementById('purchase-price-per-share');
                this.totalPurchasePrice = document.getElementById('total-purchase-price');
                this.totalWithCommission = document.getElementById('total-with-commission');
                this.currentPrice = document.getElementById('current-price');
                this.commissionPercent = document.getElementById('commission-percent');
                this.commissionAmount = document.getElementById('commission-amount');

                this.backBtn = document.getElementById('back-btn');
                this.downloadBtn = document.getElementById('download-btn');
                this.newCalcBtn = document.getElementById('new-calc-btn');

                this.canvas = document.getElementById('receipt-canvas');
                this.ctx = this.canvas.getContext('2d');
            }

            bindEvents() {
                this.langToggle.addEventListener('click', (e) => {
                    if (e.target.classList.contains('lang-btn')) {
                        const lang = e.target.dataset.lang;
                        if (lang !== this.currentLang) {
                            this.switchLanguage(lang);
                        }
                    }
                });

                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.calculate();
                });

                this.setupSmartCalculations();
                this.backBtn.addEventListener('click', () => this.showMainApp());
                this.newCalcBtn.addEventListener('click', () => this.showMainApp());
                this.downloadBtn.addEventListener('click', () => this.downloadReceipt());
            }

            setupSmartCalculations() {
                const shares = this.sharesCount;
                const pricePerShare = this.purchasePricePerShare;
                const totalPrice = this.totalPurchasePrice;
                const totalWithComm = this.totalWithCommission;
                const commPercent = this.commissionPercent;
                const commAmount = this.commissionAmount;

                pricePerShare.addEventListener('input', () => {
                    if (pricePerShare.value && shares.value) {
                        const total = parseFloat(pricePerShare.value) * parseInt(shares.value);
                        totalPrice.value = total.toFixed(2);
                        this.updateTotalWithCommission();
                    }
                });

                totalPrice.addEventListener('input', () => {
                    if (totalPrice.value && shares.value) {
                        const perShare = parseFloat(totalPrice.value) / parseInt(shares.value);
                        pricePerShare.value = perShare.toFixed(2);
                        this.updateTotalWithCommission();
                    }
                });

                totalWithComm.addEventListener('input', () => {
                    if (totalWithComm.value && totalPrice.value) {
                        const commission = parseFloat(totalWithComm.value) - parseFloat(totalPrice.value);
                        if (commission >= 0) {
                            commAmount.value = commission.toFixed(2);
                            commPercent.value = '';
                        }
                    }
                });

                shares.addEventListener('input', () => {
                    if (pricePerShare.value) {
                        const total = parseFloat(pricePerShare.value) * parseInt(shares.value || 0);
                        totalPrice.value = total.toFixed(2);
                    } else if (totalPrice.value) {
                        const perShare = parseFloat(totalPrice.value) / parseInt(shares.value || 1);
                        pricePerShare.value = perShare.toFixed(2);
                    }
                    this.updateTotalWithCommission();
                });

                commPercent.addEventListener('input', () => {
                    if (commPercent.value) {
                        commAmount.value = '';
                        this.updateTotalWithCommission();
                    }
                });

                commAmount.addEventListener('input', () => {
                    if (commAmount.value) {
                        commPercent.value = '';
                        this.updateTotalWithCommission();
                    }
                });
            }

            updateTotalWithCommission() {
                const total = parseFloat(this.totalPurchasePrice.value) || 0;
                const shares = parseInt(this.sharesCount.value) || 0;
                const current = parseFloat(this.currentPrice.value) || 0;
                const commPercent = parseFloat(this.commissionPercent.value) || 0;
                const commAmount = parseFloat(this.commissionAmount.value) || 0;

                let commission = 0;
                const currentValue = current * shares;

                if (commPercent > 0) {
                    commission = (currentValue * commPercent) / 100;
                } else if (commAmount > 0) {
                    commission = commAmount;
                }

                const totalWithComm = total + commission;
                if (total > 0 && commission > 0) {
                    this.totalWithCommission.value = totalWithComm.toFixed(2);
                }
            }

            switchLanguage(lang) {
                this.currentLang = lang;
                document.documentElement.lang = lang;
                document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';

                this.langToggle.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === lang);
                });

                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.dataset.i18n;
                    if (translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });
            }

            initApp() {
                setTimeout(() => {
                    this.splashScreen.classList.add('hide');
                    this.mainApp.classList.add('show');
                    setTimeout(() => {
                        this.splashScreen.style.display = 'none';
                    }, 600);
                }, 2500);
            }

            calculate() {
                const shares = parseInt(this.sharesCount.value);
                const purchasePrice = parseFloat(this.purchasePricePerShare.value) || 0;
                const current = parseFloat(this.currentPrice.value);
                const commPercent = parseFloat(this.commissionPercent.value) || 0;
                const commAmount = parseFloat(this.commissionAmount.value) || 0;

                if (!shares || !current) {
                    alert(this.currentLang === 'ar' ? 'ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©' : 'Please fill in all required fields');
                    return;
                }

                const totalPurchase = purchasePrice * shares;
                const currentValue = current * shares;

                let commission = 0;
                if (commPercent > 0) {
                    commission = (currentValue * commPercent) / 100;
                } else if (commAmount > 0) {
                    commission = commAmount;
                }

                const totalWithCommission = totalPurchase + commission;
                const grossProfit = currentValue - totalPurchase;
                const netProfit = grossProfit - commission;
                const profitPercent = totalPurchase > 0 ? (netProfit / totalPurchase) * 100 : 0;
                const totalSelling = currentValue - commission;

                this.calculationData = {
                    stockName: this.stockName.value || (this.currentLang === 'ar' ? 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ' : 'Unknown'),
                    shares: shares,
                    purchasePrice: purchasePrice,
                    totalPurchase: totalPurchase,
                    totalWithCommission: totalWithCommission,
                    commission: commission,
                    commissionPercent: commPercent,
                    currentPrice: current,
                    currentValue: currentValue,
                    grossProfit: grossProfit,
                    netProfit: netProfit,
                    profitPercent: profitPercent,
                    totalSelling: totalSelling,
                    date: new Date().toLocaleDateString(this.currentLang === 'ar' ? 'ar-SA' : 'en-US'),
                    time: new Date().toLocaleTimeString(this.currentLang === 'ar' ? 'ar-SA' : 'en-US'),
                    lang: this.currentLang
                };

                this.generateReceipt();
                this.showResultScreen();
            }

            generateReceipt() {
                const ctx = this.ctx;
                const data = this.calculationData;
                const width = 600;
                const height = 900;
                const isAr = data.lang === 'ar';
                const t = translations[data.lang];

                ctx.fillStyle = '#0f172a';
                ctx.fillRect(0, 0, width, height);

                const bgGradient = ctx.createLinearGradient(0, 0, width, height);
                bgGradient.addColorStop(0, '#0f172a');
                bgGradient.addColorStop(1, '#1e293b');
                ctx.fillStyle = bgGradient;
                ctx.fillRect(0, 0, width, height);

                ctx.fillStyle = 'rgba(99, 102, 241, 0.1)';
                ctx.beginPath();
                ctx.arc(500, 150, 120, 0, Math.PI * 2);
                ctx.fill();

                const headerGradient = ctx.createLinearGradient(0, 0, width, 200);
                headerGradient.addColorStop(0, '#6366f1');
                headerGradient.addColorStop(1, '#8b5cf6');
                ctx.fillStyle = headerGradient;
                ctx.fillRect(0, 0, width, 200);

                ctx.fillStyle = 'white';
                ctx.font = 'bold 36px Tajawal, Inter, Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Stock Profit Calculator', width / 2, 80);

                ctx.font = '24px Tajawal, Inter, Arial';
                ctx.fillStyle = 'rgba(255,255,255,0.9)';
                ctx.fillText('By ER1991', width / 2, 120);

                ctx.font = '16px Tajawal, Inter, Arial';
                ctx.fillStyle = 'rgba(255,255,255,0.7)';
                ctx.fillText('¬© ER1991 2026', width / 2, 160);

                ctx.fillStyle = 'rgba(30, 41, 59, 0.95)';
                this.roundRect(ctx, 30, 230, width - 60, height - 320, 20);
                ctx.fill();
                ctx.strokeStyle = 'rgba(99, 102, 241, 0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();

                let y = 270;

                ctx.fillStyle = '#818cf8';
                ctx.font = 'bold 32px Tajawal, Inter, Arial';
                ctx.textAlign = isAr ? 'right' : 'left';
                const nameX = isAr ? width - 50 : 50;
                ctx.fillText(data.stockName, nameX, y);

                ctx.fillStyle = '#64748b';
                ctx.font = '16px Tajawal, Inter, Arial';
                ctx.fillText(t.stockName, nameX, y + 28);

                y += 75;
                this.drawDivider(ctx, 50, y - 20, width - 100, 'rgba(99, 102, 241, 0.2)');

                ctx.fillStyle = '#ec4899';
                ctx.font = 'bold 22px Tajawal, Inter, Arial';
                ctx.fillText(t.purchaseSummary, nameX, y);

                y += 45;

                ctx.fillStyle = '#f8fafc';
                ctx.font = 'bold 24px Tajawal, Inter, Arial';
                ctx.textAlign = isAr ? 'left' : 'right';
                const valX = isAr ? 50 : width - 50;
                ctx.fillText(`${data.shares} ${t.quantity}`, valX, y);
                
                ctx.textAlign = isAr ? 'right' : 'left';
                ctx.fillText(`$${data.purchasePrice.toFixed(2)}`, nameX, y);

                ctx.fillStyle = '#64748b';
                ctx.font = '14px Tajawal, Inter, Arial';
                ctx.textAlign = isAr ? 'left' : 'right';
                ctx.fillText(t.sharesCount, valX, y + 22);
                ctx.textAlign = isAr ? 'right' : 'left';
                ctx.fillText(t.pricePerShare, nameX, y + 22);

                y += 65;

                ctx.fillStyle = '#f8fafc';
                ctx.font = 'bold 28px Tajawal, Inter, Arial';
                ctx.fillText(`$${data.totalPurchase.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, nameX, y);
                
                ctx.fillStyle = '#64748b';
                ctx.font = '14px Tajawal, Inter, Arial';
                ctx.fillText(t.totalAmount, nameX, y + 24);

                y += 60;
                this.drawDivider(ctx, 50, y - 15, width - 100, 'rgba(99, 102, 241, 0.2)');

                if (data.commission > 0) {
                    ctx.fillStyle = '#f59e0b';
                    ctx.font = 'bold 20px Tajawal, Inter, Arial';
                    ctx.fillText(`-$${data.commission.toFixed(2)}`, nameX, y);

                    ctx.fillStyle = '#fbbf24';
                    ctx.font = '14px Tajawal, Inter, Arial';
                    const commLabel = data.commissionPercent > 0 ? `${t.commission} (${data.commissionPercent}%)` : t.commission;
                    ctx.fillText(commLabel, nameX, y + 22);

                    y += 55;

                    ctx.fillStyle = '#f59e0b';
                    ctx.font = 'bold 26px Tajawal, Inter, Arial';
                    ctx.fillText(`$${data.totalWithCommission.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, nameX, y);

                    ctx.fillStyle = '#fbbf24';
                    ctx.font = '14px Tajawal, Inter, Arial';
                    ctx.fillText(t.totalWithCommission, nameX, y + 24);

                    y += 60;
                    this.drawDivider(ctx, 50, y - 15, width - 100, 'rgba(245, 158, 11, 0.3)');
                }

                ctx.fillStyle = '#10b981';
                ctx.font = 'bold 22px Tajawal, Inter, Arial';
                ctx.fillText(t.currentValue, nameX, y);

                y += 40;

                ctx.fillStyle = '#f8fafc';
                ctx.font = 'bold 26px Tajawal, Inter, Arial';
                ctx.textAlign = isAr ? 'left' : 'right';
                ctx.fillText(`$${data.currentPrice.toFixed(2)}`, valX, y);
                ctx.textAlign = isAr ? 'right' : 'left';
                ctx.fillText(`$${data.currentValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, nameX, y);

                ctx.fillStyle = '#64748b';
                ctx.font = '14px Tajawal, Inter, Arial';
                ctx.textAlign = isAr ? 'left' : 'right';
                ctx.fillText(t.currentPrice, valX, y + 22);
                ctx.textAlign = isAr ? 'right' : 'left';
                ctx.fillText(t.currentValue, nameX, y + 22);

                y += 65;
                this.drawDivider(ctx, 50, y - 15, width - 100, 'rgba(16, 185, 129, 0.3)');

                const isProfit = data.netProfit >= 0;
                const resultColor = isProfit ? '#10b981' : '#ef4444';
                const resultText = isProfit ? t.profit : t.loss;

                y += 20;

                ctx.shadowColor = resultColor;
                ctx.shadowBlur = 40;
                ctx.fillStyle = resultColor + '20';
                this.roundRect(ctx, 50, y, width - 100, 140, 16);
                ctx.fill();
                ctx.shadowBlur = 0;

                ctx.strokeStyle = resultColor;
                ctx.lineWidth = 3;
                ctx.stroke();

                y += 50;

                ctx.fillStyle = resultColor;
                ctx.font = 'bold 32px Tajawal, Inter, Arial';
                ctx.textAlign = 'center';
                ctx.fillText(resultText, width / 2, y);

                y += 45;

                ctx.fillStyle = '#f8fafc';
                ctx.font = 'bold 44px Tajawal, Inter, Arial';
                const profitText = `${isProfit ? '+' : ''}$${Math.abs(data.netProfit).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                ctx.fillText(profitText, width / 2, y);

                y += 38;

                ctx.fillStyle = resultColor;
                ctx.font = 'bold 26px Tajawal, Inter, Arial';
                const percentText = `${isProfit ? '+' : ''}${data.profitPercent.toFixed(2)}%`;
                ctx.fillText(percentText, width / 2, y);

                y += 70;

                this.drawDivider(ctx, 50, y - 15, width - 100, 'rgba(255, 255, 255, 0.1)');

                ctx.fillStyle = '#94a3b8';
                ctx.font = 'bold 18px Tajawal, Inter, Arial';
                ctx.fillText(t.totalSelling, width / 2, y);

                y += 38;

                ctx.fillStyle = '#f8fafc';
                ctx.font = 'bold 36px Tajawal, Inter, Arial';
                ctx.fillText(`$${data.totalSelling.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`, width / 2, y);

                ctx.fillStyle = 'rgba(30, 41, 59, 0.95)';
                ctx.fillRect(0, height - 70, width, 70);

                ctx.fillStyle = '#64748b';
                ctx.font = '14px Tajawal, Inter, Arial';
                ctx.fillText(`${data.date} | ${data.time}`, width / 2, height - 45);
                
                ctx.fillStyle = '#6366f1';
                ctx.font = 'bold 14px Tajawal, Inter, Arial';
                ctx.fillText('¬© ER1991 2026', width / 2, height - 25);
            }

            roundRect(ctx, x, y, width, height, radius) {
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.lineTo(x + width - radius, y);
                ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                ctx.lineTo(x + width, y + height - radius);
                ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                ctx.lineTo(x + radius, y + height);
                ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                ctx.lineTo(x, y + radius);
                ctx.quadraticCurveTo(x, y, x + radius, y);
                ctx.closePath();
            }

            drawDivider(ctx, x, y, width, color) {
                ctx.strokeStyle = color;
                ctx.lineWidth = 1;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(x + width, y);
                ctx.stroke();
                ctx.setLineDash([]);
            }

            showResultScreen() {
                this.resultScreen.classList.remove('hidden');
                void this.resultScreen.offsetWidth;
                this.resultScreen.classList.add('show');
                document.body.style.overflow = 'hidden';
            }

            showMainApp() {
                this.resultScreen.classList.remove('show');
                setTimeout(() => {
                    this.resultScreen.classList.add('hidden');
                }, 400);
                document.body.style.overflow = '';
                this.form.reset();
            }

            downloadReceipt() {
                const link = document.createElement('a');
                link.download = `transaction_receipt_ER1991_${Date.now()}.png`;
                link.href = this.canvas.toDataURL('image/png');
                link.click();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new StockCalculator();
        });
    </script>
</body>
</html>
